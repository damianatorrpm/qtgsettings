language: c

compiler:
  - clang
  - gcc

sudo: required

services:
  - docker

env:
  global:
    # FTP_USER
    - secure: "I+PT9Ktn83UNRuFQI9RP8lhjPMGTIZiEot7l7dJMPAjHqRhmGtj7AssocZR8u0f79xniQGNNqM4QKw7LXJQj+VeBC2a2siAJJn6U+sVmsuuksi1meTkLFEOigk1ZZHqSBJT/KGMzz+oXGxQNkMGnLLfMx7v19O3apLEtc1XQtPeIms2Pm9vkZYAoqyTbvtGHOo+urfKu3KDY2COZyfmR/y0hI5YrE3U6z7eP0/FfmuxXa6GPSTySulT0qahyBkbc46+eNZ+vjEod5vhdpRrfyXFyHmT3wHuoxKXs+VvKsxnoEUGC0qI4gTxjUarroiCB/I43W9PyVsXYGK6q65n9rykXeU9iASBX4CctjQDIWfccsDoVY9k5JrJUImmh/R4EfCNN9RE5Eac+JTvuJ49vDmqhPMGqaELEHP+e8qHnbvo474KVq1y4Q881p3YhAqbTVz1wN0GABTMa2F1fCcEKQ/FeGMOif8GvLhzf8H+S7eII/Tmsz+E9NJH6T2LLoN6vPqMxODyMtgmkz7JPAmtUZZcvPYYl1J25EeuZZjmqbKduPA4/S6YLEhvJhmMXZaTyxgwz3S9jKUGdIluth2qdl45tByg4CIn4Q69Lk9CXT+FztgdF/hBSRDvXLZRW9aunok8jtr4kghbVjakIj88ycdakZ6CoMFXu4k+s5Z3H6yc="
    # FTP_PASSWORD
    - secure: "L3g1GlqVjTlvPlhsYTdZ0U0WToqU1BVXnO4fUznBzC1h2DLhsg6HTcJwKcYRb6qRgnUOWOT3vxLKolVK7bxGqmyzsgiMxu3rOquHcApBGVFb2Wruq08FsiW9XdOu/IO0BzeYyxmq+9IzYcg6VXDxg0oPAT8Euq+lpamVoCtAQuVta0uek/yqgrAOboJG8HwzOdqdoKwUVvO7XBtYG5GM4TUEXORGvrRwPGUOBsBhPnL59QtkLzTIlDZMRVgi4YWG+L31mueR3orWhW8NR6BlIWRfeE4daviMsSAyhjEmkcTPicxPrjLsWvTJBcu1Aal0ApWuBmWtjsU9PFE4jgn+XLQ4tuEMUUjW//DRrGe1OgEYeF/CdJVo1CKMSvBEPqDI/C2le2d0w9Vj9soHY7AGlFmONW2DNkakcbfilUWsoOaLUlgga9xHkyDpDVTg7TrPZo5ttgeCc+Sm/6DWy+jwQ+XLih/GePrS2NXkEph/M1PrqelFiLtyKi/MZdQ6NartUTRGr0erItubHaAKGiZU4gDLuLYZNOGxGswRJBWWrn77mLKMB0Avsk9PIdiuXh58ajxJyAVvVSfLSrvfBcHBf3Vmu9TYvE4ujqx9FkBLcnnApaRRQCEu2qz3ilzyY2eAbufdLcV9hzPu94yY1Ldvgs4rqqW+lPIRpdCY536Hj8w="
    # FTP_URL
    - secure: "bm/tcZDotHXlMxvnDRZP/qKoSs0u7xegyl4U9QMEgWQlMiBJHLx6v0ztxygqOCq8kV6uYxKGdKRegDH6pjdA8HtSfrqLLZUhhDoye7Qcr+ShyTWEYxVfyAJpPnPHF3HfBow2KjUZGem53GxxrhKGjwbIII4FTphoY7G1b3rwDfOcBzXvxOjsVGTnx5JY3J2fJ2L1iEsd7sk1rKOzcGqcLnm4rlLlaCtS0dRnDG1DAaYkWgF6XInx0vNtKxeNlRsULS2q6Ivj54iJVVg41+Lxb3QEqjniEqVHbuIPAV786+eykh04ZWhVgxmeS1lpCiqnCkxXhj7YXlpsGlXMskmjc5Dx7/zVugQ4zTXTUD3tm+Lz9mkzhUSTa6L+Oh2dKV/KnR9pkU75oH6Xwn+l451azyJvSmt7XZycAHg+6Vukusv1esipfsbDz8uDTl8jYAVVxWsq0MnGtBS5ZYoXCKtyna4dHaoVlG9eIY47CTzGUy1EpbhRSag+oJwmMy8BmjB15YTHy3+WFssqaRF55sZHCOGOvy9bW4CUzTJ0CaUnCa/01XzKio1e50pxij3Pp4vNh6DCJNeoOOGDtLVpo+Ill52mKdnY0Uj+gLFn9QoNGqmvPjU5Wfgg2qYmI7k+7rK+eGEG3Jvpt1CgD2dCUT9BjBRVzcQPyBX6GAyTgqLYmno="

arch:
  packages:
    - qbs
    - qt5-declarative
    - glib2
    #- clazy-git
    - xorg-server-xvfb
  script:
    - export CLAZY_CHECKS="level1"
    - qbs-setup-toolchains --detect
    - qbs-setup-qt /usr/bin/qmake-qt5 qt5
    - qbs config profiles.qt5.baseProfile ${CC}
    - eval `dbus-launch --sh-syntax` && xvfb-run -a -s "-screen 0 800x600x24" qbs build -d build -j $(nproc) --all-products profile:qt5 qbs.installRoot:/ qbs.installPrefix:usr

script:
  - "curl -s https://raw.githubusercontent.com/lirios/repotools/develop/travis/docker-travis.sh | bash"

deploy:
  - provider: script
    script: curl --ftp-create-dirs -T build/default/qtgsettings-artifacts.tar.gz -u $FTP_USER:$FTP_PASSWORD $FTP_URL/artifacts/master/qtgsettings-artifacts.tar.gz
    skip_cleanup: true
    on:
      branch: master
      condition: "$CC = gcc"
  - provider: script
    script: curl --ftp-create-dirs -T build/default/qtgsettings-artifacts.tar.gz -u $FTP_USER:$FTP_PASSWORD $FTP_URL/artifacts/develop/qtgsettings-artifacts.tar.gz
    skip_cleanup: true
    on:
      branch: develop
      condition: "$CC = gcc"

notifications:
  email: false
  slack: lirios:fdUqVmPzqPskEL1UBhqapZ0w
